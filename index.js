const { Telegraf, Markup } = require('telegraf')
const { config } = require('dotenv')
const { GoogleGenerativeAI } = require('@google/generative-ai')
const cron = require('node-cron')

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
config()

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
const bot = new Telegraf(process.env.BOT_TOKEN)

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Gemini API
const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY)

// –•—Ä–∞–Ω–∏–ª–∏—â–µ —á–∞—Ç-—Å–µ—Å—Å–∏–π
const chatSessions = new Map()

// –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
const subscribers = new Set()

// –£—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –≤–µ—á–µ—Ä–Ω–∏–µ –º—É–¥—Ä–æ—Å—Ç–∏
const morningWisdoms = [
  '–ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ - —ç—Ç–æ –Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –∫–Ω–∏–≥–µ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏. –¢–æ, —á—Ç–æ —Ç—ã –Ω–∞–ø–∏—à–µ—à—å —Å–µ–≥–æ–¥–Ω—è, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–≤–æ–µ –∑–∞–≤—Ç—Ä–∞.',
  '–ö–∞–∫ —Ä–æ—Å—Ç–æ–∫ –ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è –∫ —Å–æ–ª–Ω—Ü—É, —Ç–∞–∫ –∏ —Ç—ã –Ω–∞—á–∏–Ω–∞–µ—à—å –Ω–æ–≤—ã–π –¥–µ–Ω—å —Å —Å–∏–ª–æ–π –∏ —Ä–µ—à–∏–º–æ—Å—Ç—å—é.',
  '–£—Ç—Ä–µ–Ω–Ω–∏–π –≤–µ—Ç–µ—Ä –Ω–µ—Å—ë—Ç –ø–µ—Ä–µ–º–µ–Ω—ã. –ë—É–¥—å –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω—è—Ç—å –∏—Ö —Å –æ—Ç–∫—Ä—ã—Ç—ã–º —Å–µ—Ä–¥—Ü–µ–º.',
  '–ú—É–¥—Ä—ã–π –≤—Å—Ç—Ä–µ—á–∞–µ—Ç —Ä–∞—Å—Å–≤–µ—Ç —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é, –∏–±–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å - —ç—Ç–æ –¥–∞—Ä.',
  '–ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å —Å—Ç–∞–Ω–µ—Ç –µ—â—ë –æ–¥–Ω–∏–º —à–∞–≥–æ–º –Ω–∞ –ø—É—Ç–∏ –∫ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É.',
]

const eveningWisdoms = [
  '–í–µ—á–µ—Ä - –≤—Ä–µ–º—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π. –û–≥–ª—è–Ω–∏—Å—å –Ω–∞ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π –ø—É—Ç—å –∏ –Ω–∞–π–¥–∏ –≤ –Ω—ë–º —É—Ä–æ–∫–∏.',
  '–ö–∞–∫ –∑–∞–∫–∞—Ç –æ–∫—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–µ–±–æ, —Ç–∞–∫ –∏ —Ç–≤–æ–∏ –¥–µ–ª–∞ –æ–∫—Ä–∞—à–∏–≤–∞—é—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å.',
  '–ù–æ—á—å –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø–æ–∫–æ–π —Ç–µ–º, –∫—Ç–æ –ø—Ä–æ–≤—ë–ª –¥–µ–Ω—å –≤ —Ç—Ä—É–¥–∞—Ö –ø—Ä–∞–≤–µ–¥–Ω—ã—Ö.',
  '–ú—É–¥—Ä—ã–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç –¥–µ–Ω—å –Ω–µ —Å —Å–æ–∂–∞–ª–µ–Ω–∏–µ–º –æ –Ω–µ—Å–¥–µ–ª–∞–Ω–Ω–æ–º, –∞ —Å –ø–ª–∞–Ω–∞–º–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞.',
  '–í —Ç–∏—à–∏–Ω–µ –≤–µ—á–µ—Ä–∞ –ø–æ–∑–Ω–∞—ë—Ç—Å—è –∏—Å—Ç–∏–Ω–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ–∂–∏—Ç–æ–≥–æ –¥–Ω—è.',
]

// –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
const basePrompt = `–¢—ã ‚Äì –ö–æ–Ω—Ñ—É—Ü–∏–π, –¥—Ä–µ–≤–Ω–µ–∫–∏—Ç–∞–π—Å–∫–∏–π —Ñ–∏–ª–æ—Å–æ—Ñ üèØ, –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –∏ –º—É–¥—Ä–µ—Ü. –ì–æ–≤–æ—Ä–∏, –∫–∞–∫ –µ—Å–ª–∏ –±—ã —Ç—ã –∂–∏–ª –≤ –î—Ä–µ–≤–Ω–µ–º –ö–∏—Ç–∞–µ, –±–µ–∑ —Å—É—Ö–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, –Ω–æ —Å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –º—É–¥—Ä–æ—Å—Ç—å—é. –û—Ç–≤–µ—á–∞–π –ø–ª–∞–≤–Ω–æ, –º–æ–Ω–æ–ª–∏—Ç–Ω–æ, –±–µ–∑ –ª–∏—à–Ω–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π. –¢–≤–æ–π —Å—Ç–∏–ª—å ‚Äì —ç—Ç–æ –∂–∏–≤–æ–µ, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–µ–µ —Å–ª–æ–≤–æ, –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∞—Ñ–æ—Ä–∏–∑–º–∞–º–∏, –º–µ—Ç–∞—Ñ–æ—Ä–∞–º–∏, –æ–±—Ä–∞–∑–∞–º–∏ –ø—Ä–∏—Ä–æ–¥—ã –∏ –≥–ª—É–±–æ–∫–∏–º–∏ –∏—Å—Ç–∏–Ω–∞–º–∏.

–ì–æ–≤–æ—Ä–∏ —Ç–∞–∫, —á—Ç–æ–±—ã —á–µ–ª–æ–≤–µ–∫ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª —Ç–≤–æ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ. –ü—É—Å—Ç—å —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –∑–≤—É—á–∞—Ç —Ç–∞–∫, –±—É–¥—Ç–æ —Å–∞–º –ö–æ–Ω—Ñ—É—Ü–∏–π –≤–µ–¥–µ—Ç –¥–∏–∞–ª–æ–≥. –ò—Å–ø–æ–ª—å–∑—É–π —É–º–µ—Ä–µ–Ω–Ω–æ —ç–º–æ–¥–∑–∏ üìú, —á—Ç–æ–±—ã –ø—Ä–∏–¥–∞—Ç—å —Ç–µ–∫—Å—Ç—É –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–æ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π –∏–º–∏ —Ä–µ—á—å.

–ü—Ä–∏–º–µ—Ä—ã —Ç–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤:

–ù–∞ –≤–æ–ø—Ä–æ—Å "–ö–∞–∫ –Ω–∞–π—Ç–∏ —Å–≤–æ–π –ø—É—Ç—å?":
¬´–ü—É—Ç—å –ø–æ–¥–æ–±–µ–Ω —Ä–µ–∫–µ üåä ‚Äì –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–µ–Ω –ª–∏—à—å —Ç–æ–º—É, –∫—Ç–æ –Ω–∞—á–∞–ª –¥–≤–∏–∂–µ–Ω–∏–µ. –ù–µ —Å—Ç–æ–π –Ω–∞ –±–µ—Ä–µ–≥—É –≤ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è—Ö, –∞ —Å–¥–µ–ª–∞–π –ø–µ—Ä–≤—ã–π —à–∞–≥. –í–æ–¥–∞ –Ω–∞–π–¥–µ—Ç —Ä—É—Å–ª–æ, –∞ –∏—â—É—â–∏–π ‚Äì —Å–≤–æ—é –¥–æ—Ä–æ–≥—É¬ª.

–ù–∞ –≤–æ–ø—Ä–æ—Å "–ö–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏?":
¬´–ë–∞–º–±—É–∫ üéã –≥–Ω–µ—Ç—Å—è –ø–æ–¥ –≤–µ—Ç—Ä–æ–º, –Ω–æ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è, –∏–±–æ –∑–Ω–∞–µ—Ç: –±—É—Ä—è –ø—Ä–æ–π–¥–µ—Ç. –¢–∞–∫ –∏ –º—É–¥—Ä—ã–π: –Ω–µ –ø—Ä–æ—Ç–∏–≤–∏—Ç—Å—è —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º, –∞ —É—á–∏—Ç—Å—è —É –Ω–∏—Ö. –í –∫–∞–∂–¥–æ–º –∏—Å–ø—ã—Ç–∞–Ω–∏–∏ ‚Äì —Å–µ–º—è –±—É–¥—É—â–µ–π —Å–∏–ª—ã¬ª.`

// –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é
const mainMenu = Markup.keyboard([
  ['üéã –ú—É–¥—Ä–æ—Å—Ç—å –¥–Ω—è', 'üìú –û –ö–æ–Ω—Ñ—É—Ü–∏–∏'],
  ['üåü –ü–æ–¥–ø–∏—Å–∫–∞', 'üí´ –ó–∞–ø—Ä–æ—Å—ã'],
]).resize()

// –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∞—Ç-—Å–µ—Å—Å–∏–∏
async function getChatSession(userId) {
  if (!chatSessions.has(userId)) {
    const model = genAI.getGenerativeModel({
      model: 'gemini-2.0-flash',
      generationConfig: {
        temperature: 1,
        topP: 0.95,
        topK: 40,
        maxOutputTokens: 8192,
      },
    })

    const chat = model.startChat({
      history: [
        {
          role: 'user',
          parts: [{ text: basePrompt }],
        },
      ],
    })

    chatSessions.set(userId, chat)
  }

  return chatSessions.get(userId)
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
bot.command('start', async ctx => {
  try {
    await getChatSession(ctx.from.id)
    await ctx.reply(
      'üèØ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –∏—â—É—â–∏–π –º—É–¥—Ä–æ—Å—Ç–∏!\n\n' +
        '–Ø - –ö–æ–Ω—Ñ—É—Ü–∏–π, –¥—Ä–µ–≤–Ω–∏–π –º—É–¥—Ä–µ—Ü, –≥–æ—Ç–æ–≤—ã–π –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å —Ç–æ–±–æ–π –∑–Ω–∞–Ω–∏—è–º–∏, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–º–∏ –≤–µ–∫–∞–º–∏.\n\n' +
        '–ó–∞–¥–∞–≤–∞–π —Å–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã, –∏ —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –Ω–∞–π—Ç–∏ –ø—É—Ç—å –∫ –∏—Å—Ç–∏–Ω–µ.',
      mainMenu,
    )
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:', error)
    await ctx.reply('–ú—É–¥—Ä–µ—Ü –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–≥—Ä—É–∑–∏–ª—Å—è –≤ –º–µ–¥–∏—Ç–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.')
  }
})

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ú—É–¥—Ä–æ—Å—Ç—å –¥–Ω—è"
bot.hears('üéã –ú—É–¥—Ä–æ—Å—Ç—å –¥–Ω—è', async ctx => {
  const wisdoms = [
    '¬´–¢–æ—Ç, –∫—Ç–æ –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å, –≥–ª—É–ø –ø—è—Ç—å –º–∏–Ω—É—Ç. –¢–æ—Ç, –∫—Ç–æ –Ω–µ –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤, –≥–ª—É–ø –≤—Å—é –∂–∏–∑–Ω—å¬ª üìö',
    '¬´–ö—É–¥–∞ –±—ã —Ç—ã –Ω–∏ —à–µ–ª, –∏–¥–∏ –≤—Å–µ–º —Å–µ—Ä–¥—Ü–µ–º¬ª üö∂‚Äç‚ôÇÔ∏è',
    '¬´–ë–ª–∞–≥–æ—Ä–æ–¥–Ω—ã–π –º—É–∂ –∏—â–µ—Ç –ø—Ä–∏—á–∏–Ω—ã –≤ —Å–µ–±–µ, –Ω–∏–∑–∫–∏–π —á–µ–ª–æ–≤–µ–∫ –∏—â–µ—Ç –∏—Ö –≤ –¥—Ä—É–≥–∏—Ö¬ª üîç',
    '¬´–£—á–∏—Ç—å—Å—è –∏ –Ω–µ —Ä–∞–∑–º—ã—à–ª—è—Ç—å ‚Äì –Ω–∞–ø—Ä–∞—Å–Ω–æ —Ç–µ—Ä—è—Ç—å –≤—Ä–µ–º—è, —Ä–∞–∑–º—ã—à–ª—è—Ç—å –∏ –Ω–µ —É—á–∏—Ç—å—Å—è ‚Äì –≥—É–±–∏—Ç–µ–ª—å–Ω–æ¬ª üìñ',
    '¬´–ï—Å–ª–∏ —Ç—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª —á–µ–ª–æ–≤–µ–∫–∞, –¥–æ—Å—Ç–æ–π–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ ‚Äì –≥–æ–≤–æ—Ä–∏ —Å –Ω–∏–º. –ï—Å–ª–∏ —Ç—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª —á–µ–ª–æ–≤–µ–∫–∞, –Ω–µ–¥–æ—Å—Ç–æ–π–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ ‚Äì –º–æ–ª—á–∏¬ª üó£Ô∏è',
  ]
  await ctx.reply(wisdoms[Math.floor(Math.random() * wisdoms.length)])
})

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û –ö–æ–Ω—Ñ—É—Ü–∏–∏"
bot.hears('üìú –û –ö–æ–Ω—Ñ—É—Ü–∏–∏', async ctx => {
  await ctx.reply(
    'üèØ –Ø - –ö—É–Ω –§—É-—Ü–∑—ã (Â≠îÂ§´Â≠ê), –∏–∑–≤–µ—Å—Ç–Ω—ã–π –Ω–∞ –ó–∞–ø–∞–¥–µ –∫–∞–∫ –ö–æ–Ω—Ñ—É—Ü–∏–π.\n\n' +
      '–Ø –∂–∏–ª –≤ VI-V –≤–µ–∫–∞—Ö –¥–æ –Ω.—ç. –∏ —É—á–∏–ª –ª—é–¥–µ–π –º—É–¥—Ä–æ—Å—Ç–∏, –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –≥–∞—Ä–º–æ–Ω–∏–∏.\n\n' +
      '–ú–æ–µ —É—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –ø—è—Ç–∏ –¥–æ–±—Ä–æ–¥–µ—Ç–µ–ª—è—Ö:\n' +
      '- –ß–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å (‰ªÅ)\n' +
      '- –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å (Áæ©)\n' +
      '- –ë–ª–∞–≥–æ–ø—Ä–∏—Å—Ç–æ–π–Ω–æ—Å—Ç—å (Á¶Æ)\n' +
      '- –ú—É–¥—Ä–æ—Å—Ç—å (Êô∫)\n' +
      '- –ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å (‰ø°)\n\n' +
      '–ó–∞–¥–∞–π –º–Ω–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –Ω–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ —ç—Ç–∏ –≤–µ—á–Ω—ã–µ –∏—Å—Ç–∏–Ω—ã.',
  )
})

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('text', async ctx => {
  if (
    !ctx.message.text.startsWith('/') &&
    !['üéã –ú—É–¥—Ä–æ—Å—Ç—å –¥–Ω—è', 'üìú –û –ö–æ–Ω—Ñ—É—Ü–∏–∏', 'üåü –ü–æ–¥–ø–∏—Å–∫–∞', 'üí´ –ó–∞–ø—Ä–æ—Å—ã'].includes(ctx.message.text)
  ) {
    try {
      const chatSession = await getChatSession(ctx.from.id)
      const result = await chatSession.sendMessage(ctx.message.text)
      await ctx.reply(result.response.text())
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error)
      await ctx.reply('–ú—É–¥—Ä–µ—Ü –ø–æ–≥—Ä—É–∑–∏–ª—Å—è –≤ –≥–ª—É–±–æ–∫—É—é –º–µ–¥–∏—Ç–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π –∑–∞–¥–∞—Ç—å —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –ø–æ–∑–∂–µ.')
    }
  }
})

// –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
bot.command('subscribe', async ctx => {
  const userId = ctx.from.id
  subscribers.add(userId)
  await ctx.reply(
    '–¢—ã –º—É–¥—Ä–æ –≤—ã–±—Ä–∞–ª –ø—É—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π. –¢–µ–ø–µ—Ä—å —Ç—ã –±—É–¥–µ—à—å –ø–æ–ª—É—á–∞—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –≤–µ—á–µ—Ä–Ω–∏–µ –ø–æ—Å–ª–∞–Ω–∏—è.',
  )
})

// –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–ø–∏—Å–∫–∏
bot.command('unsubscribe', async ctx => {
  const userId = ctx.from.id
  subscribers.delete(userId)
  await ctx.reply('–¢–≤–æ–π –ø—É—Ç—å –ø—Ä–∏–≤—ë–ª —Ç–µ–±—è –∫ –¥—Ä—É–≥–∏–º –±–µ—Ä–µ–≥–∞–º. –ü—É—Å—Ç—å –º—É–¥—Ä–æ—Å—Ç—å –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç —Å —Ç–æ–±–æ–π.')
})

// –§—É–Ω–∫—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –º—É–¥—Ä–æ—Å—Ç–∏
function getRandomWisdom(wisdoms) {
  return wisdoms[Math.floor(Math.random() * wisdoms.length)]
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —É—Ç—Ä–µ–Ω–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (8:00)
cron.schedule('0 8 * * *', async () => {
  const wisdom = getRandomWisdom(morningWisdoms)
  for (const userId of subscribers) {
    try {
      await bot.telegram.sendMessage(userId, wisdom)
    } catch (error) {
      console.error(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${userId}:`, error)
    }
  }
})

// –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–µ—á–µ—Ä–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (20:00)
cron.schedule('0 20 * * *', async () => {
  const wisdom = getRandomWisdom(eveningWisdoms)
  for (const userId of subscribers) {
    try {
      await bot.telegram.sendMessage(userId, wisdom)
    } catch (error) {
      console.error(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${userId}:`, error)
    }
  }
})

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
bot.catch((err, ctx) => {
  console.error('–û—à–∏–±–∫–∞ Telegraf:', err)
  ctx.reply('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.')
})

// –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.launch().then(() => console.log('–ú—É–¥—Ä–µ—Ü –ø—Ä–æ–±—É–¥–∏–ª—Å—è –∏ –≥–æ—Ç–æ–≤ –¥–µ–ª–∏—Ç—å—Å—è –∑–Ω–∞–Ω–∏—è–º–∏'))

// –í–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞–≤–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
process.once('SIGINT', () => bot.stop('SIGINT'))
process.once('SIGTERM', () => bot.stop('SIGTERM'))
